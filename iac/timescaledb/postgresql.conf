# -----------------------------
# PostgreSQL configuration file
# -----------------------------

#------------------------------------------------------------------------------
# FILE LOCATIONS
#------------------------------------------------------------------------------

# The default values of these variables are driven from the -D command-line
# option or PGDATA environment variable.

data_directory = '/var/lib/postgresql/17/main' # use data in another directory
					# (change requires restart)
hba_file = '/etc/postgresql/17/main/pg_hba.conf' # host-based authentication file
					# (change requires restart)
ident_file = '/etc/postgresql/17/main/pg_ident.conf' # ident configuration file
					# (change requires restart)

# If external_pid_file is not explicitly set, no extra PID file is written.
external_pid_file = '/var/run/postgresql/17-main.pid' # write an extra PID file
					# (change requires restart)

#------------------------------------------------------------------------------
# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------

# - Connection Settings -

listen_addresses = '*'
					# comma-separated list of addresses;
					# defaults to 'localhost'; use '*' for all
					# (change requires restart)
#port = 5432				# (change requires restart)
max_connections = 100			# (change requires restart)

#------------------------------------------------------------------------------
# RESOURCE USAGE (except WAL)
#------------------------------------------------------------------------------

# - Memory -

shared_buffers = 14848MB		# min 128kB
					# (change requires restart)
work_mem = 128MB		# min 64kB
maintenance_work_mem = 7424MB		# min 1MB
autovacuum_work_mem = 232MB		# min 1MB, or -1 to use maintenance_work_mem
dynamic_shared_memory_type = posix	# the default is usually the first option

# - Asynchronous Behavior -

#backend_flush_after = 0		# measured in pages, 0 disables
effective_io_concurrency = 256		# 1-1000; 0 disables prefetching
#maintenance_io_concurrency = 10	# 1-1000; 0 disables prefetching
max_worker_processes = 24		# (change requires restart)
max_parallel_workers_per_gather = 23		# taken from max_parallel_workers
#max_parallel_maintenance_workers = 2	# taken from max_parallel_workers
max_parallel_workers = 23		# maximum number of max_worker_processes that
								# can be used in parallel operations



#------------------------------------------------------------------------------
# WRITE-AHEAD LOG
#------------------------------------------------------------------------------

# - Settings -

wal_buffers = 16MB			# min 32kB, -1 sets based on shared_buffers
					# (change requires restart)

checkpoint_completion_target = 0.9	# checkpoint target duration, 0.0 - 1.0
max_wal_size = 1GB
min_wal_size = 512MB

#------------------------------------------------------------------------------
# QUERY TUNING
#------------------------------------------------------------------------------

# - Planner Cost Constants -

random_page_cost = 1.1			# same scale as above
effective_cache_size = 44544MB

default_statistics_target = 100	# range 1-10000

#------------------------------------------------------------------------------
# REPORTING AND LOGGING
#------------------------------------------------------------------------------
log_timezone = 'UTC'

#------------------------------------------------------------------------------
# AUTOVACUUM
#------------------------------------------------------------------------------

#autovacuum = on			# Enable autovacuum subprocess?  'on'
					# requires track_counts to also be on.
autovacuum_max_workers = 23		# max number of autovacuum subprocesses
					# (change requires restart)
autovacuum_naptime = 10		# time between autovacuum runs


# - Locale and Formatting -

datestyle = 'iso, mdy'
#intervalstyle = 'postgres'
timezone = 'UTC'

# These settings are initialized by initdb, but they can be changed.
lc_messages = 'en_US.utf8'			# locale for system error message
					# strings
lc_monetary = 'en_US.utf8'			# locale for monetary formatting
lc_numeric = 'en_US.utf8'			# locale for number formatting
lc_time = 'en_US.utf8'				# locale for time formatting

# default configuration for text search
default_text_search_config = 'pg_catalog.english'

# - Shared Library Preloading -

shared_preload_libraries = 'timescaledb,pg_stat_statements,pgvectorscale'	# (change requires restart)

#------------------------------------------------------------------------------
# LOCK MANAGEMENT
#------------------------------------------------------------------------------

max_locks_per_transaction = 512		# min 10

#------------------------------------------------------------------------------
# CUSTOMIZED OPTIONS
#------------------------------------------------------------------------------

# Add settings for extensions here
timescaledb.telemetry_level=basic
timescaledb.max_background_workers = 23
timescaledb.enable_chunk_skipping = on
